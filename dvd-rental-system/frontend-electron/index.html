
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>DVD Rental Desktop</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 20px; }
    .card { border:1px solid #ddd; padding: 16px; border-radius: 10px; margin-bottom: 16px; }
    input, select, button { padding: 8px; margin: 4px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background: #f5f5f5; }
    .row { display: flex; gap: 16px; }
    .row > div { flex: 1; }
    .ok { color: green; }
    .err { color: red; }
  </style>
</head>
<body>
  <h1>DVD Rental Desktop (HTML + CSS + JS)</h1>

  <div class="card">
    <h3>Login</h3>
    <label>Role:
      <select id="role">
        <option value="customer">customer</option>
        <option value="staff">staff</option>
      </select>
    </label>
    <input id="email" placeholder="email" size="35">
    <button id="btnLogin">Login</button>
    <div id="loginStatus"></div>
  </div>

  <div class="row">
    <div class="card">
      <h3>Rent a DVD</h3>
      <input id="filmId" placeholder="film_id e.g. 1">
      <button id="findInv">Find available inventory</button>
      <div>Inventory <select id="inventory"></select></div>
      <div>Customer ID <input id="customerId" placeholder="e.g. 1"></div>
      <div>Staff ID <input id="staffId" placeholder="e.g. 1"></div>
      <button id="doRent">Create Rental</button>
      <div id="rentStatus"></div>
    </div>

    <div class="card">
      <h3>Return / Cancel</h3>
      <input id="rentalId" placeholder="rental_id">
      <button id="doReturn">Return</button>
      <button id="doCancel">Cancel</button>
      <div id="returnStatus"></div>
    </div>
  </div>

  <div class="card">
    <h3>Reports</h3>
    <div>
      Customer ID <input id="repCustomerId" placeholder="e.g. 1">
      <button id="repCust">Customer Rentals</button>
    </div>
    <div>
      <button id="repNotReturned">Not Returned</button>
      <button id="repTop">Top Rented</button>
      Limit <input id="repLimit" value="10" size="4">
    </div>
    <div>
      <button id="repRevenue">Revenue by Staff</button>
    </div>
    <div id="reportOut"></div>
  </div>

<script>
const API = 'http://localhost:8080';

function out(el, msg, ok=true){
  el.innerHTML = `<span class="${ok?'ok':'err'}">${ok?'✔':'✖'} ${msg}</span>`;
}
async function login(){
  const role = document.getElementById('role').value;
  const email = document.getElementById('email').value;
  const res = await fetch(API + '/api/auth/login', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({email, role})
  });
  const data = await res.json();
  out(document.getElementById('loginStatus'), res.ok? `Logged in as ${data.name} (${data.role}) id=${data.id}`: data.error, res.ok);
}
async function findInv(){
  const filmId = document.getElementById('filmId').value;
  const res = await fetch(API + '/api/inventory/available?film_id='+encodeURIComponent(filmId));
  const data = await res.json();
  const sel = document.getElementById('inventory');
  sel.innerHTML='';
  (data.inventory_ids||[]).forEach(id => {
    const o=document.createElement('option'); o.value=id; o.textContent=id; sel.appendChild(o);
  });
}
async function doRent(){
  const customerId = +document.getElementById('customerId').value;
  const staffId = +document.getElementById('staffId').value;
  const inventoryId = +document.getElementById('inventory').value;
  const res = await fetch(API + '/api/rentals', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({customer_id:customerId, staff_id:staffId, inventory_id:inventoryId})
  });
  const data = await res.json();
  out(document.getElementById('rentStatus'), res.ok? `Rental created id=${data.rental_id}`: data.error, res.ok);
}
async function doReturn(){
  const id = document.getElementById('rentalId').value;
  const res = await fetch(API + '/api/returns/'+id, {method:'POST'});
  const data = await res.json().catch(()=>({}));
  out(document.getElementById('returnStatus'), res.ok? `Returned ${id}`: (data.error||'error'), res.ok);
}
async function doCancel(){
  const id = document.getElementById('rentalId').value;
  const res = await fetch(API + '/api/rentals/'+id+'/cancel', {method:'POST'});
  const data = await res.json().catch(()=>({}));
  out(document.getElementById('returnStatus'), res.ok? `Canceled ${id}`: (data.error||'error'), res.ok);
}

async function repCustomer(){
  const id = document.getElementById('repCustomerId').value;
  const res = await fetch(API + '/api/reports/customer/'+id+'/rentals');
  const data = await res.json();
  renderTable(data);
}
async function repNotReturned(){
  const res = await fetch(API + '/api/reports/not-returned');
  renderTable(await res.json());
}
async function repTop(){
  const limit = document.getElementById('repLimit').value;
  const res = await fetch(API + '/api/reports/top-rented?limit='+limit);
  renderTable(await res.json());
}
async function repRevenue(){
  const res = await fetch(API + '/api/reports/revenue-by-staff');
  renderTable(await res.json());
}
function renderTable(rows){
  if(!Array.isArray(rows)){ document.getElementById('reportOut').innerText = 'No data'; return; }
  if(rows.length===0){ document.getElementById('reportOut').innerText = 'Empty'; return; }
  const keys = Object.keys(rows[0]);
  const html = `<table><thead><tr>${keys.map(k=>`<th>${k}</th>`).join('')}</tr></thead>` +
    `<tbody>${rows.map(r=>`<tr>${keys.map(k=>`<td>${r[k]??''}</td>`).join('')}</tr>`).join('')}</tbody></table>`;
  document.getElementById('reportOut').innerHTML = html;
}

document.getElementById('btnLogin').onclick = login;
document.getElementById('findInv').onclick = findInv;
document.getElementById('doRent').onclick = doRent;
document.getElementById('doReturn').onclick = doReturn;
document.getElementById('doCancel').onclick = doCancel;
document.getElementById('repCust').onclick = repCustomer;
document.getElementById('repNotReturned').onclick = repNotReturned;
document.getElementById('repTop').onclick = repTop;
document.getElementById('repRevenue').onclick = repRevenue;
</script>
</body>
</html>
